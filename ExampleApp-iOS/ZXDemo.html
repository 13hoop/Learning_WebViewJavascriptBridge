<!doctype html>
<html><head>
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
	<style type='text/css'>
		html { font-family:Helvetica; color:#222; }
		h1 { color:steelblue; font-size:24px; margin-top:24px; }
		button { margin:0 3px 10px; font-size:12px; }
		.logLine { border-bottom:1px solid #ccc; padding:4px 2px; font-family:courier; font-size:11px; }
        
        .colorDes {
            color: red;
        }
	</style>
</head><body>
	<h1 class="colorDes">WebViewJavascriptBridge demoå­¦ä¹  by yongSir</h1>

<!--è„šæœ¬å¼€å§‹çš„åœ°æ–¹-->
    <script>
	window.onerror = function(err) {
		log('window.onerror: ' + err)
	}
	
    <!--åˆ›å»º connectWebViewJavascriptBridge æ–¹æ³•-->
	function connectWebViewJavascriptBridge(callback) {
		if (window.WebViewJavascriptBridge) {
			callback(WebViewJavascriptBridge)
		} else {
			document.addEventListener('WebViewJavascriptBridgeReady', function() {
				callback(WebViewJavascriptBridge)
			}, false)
		}
	}
	
    <!--è°ƒç”¨ connectWebViewJavascriptBridge æ–¹æ³•-->
    <!-- å¯ä»¥çœ‹åˆ°ä¼ è¯´ä¸­çš„å†…åµŒå‡½æ•°(Nested function) -->
	connectWebViewJavascriptBridge(function(bridge) {
                                   
                        
        <!--è¾“å‡ºå‡½æ•°-->
		var uniqueId = 1
        function log(message, data) {
			var log = document.getElementById('log')
			var el = document.createElement('div')
			el.className = 'logLine'
			el.innerHTML = uniqueId++ + '. ' + message + ':<br/>' + JSON.stringify(data)
			if (log.children.length) { log.insertBefore(el, log.children[0]) }
			else { log.appendChild(el) }
		}

        <!-- OCå‘JSå‘æ¶ˆæ¯ï¼ŒJSä¸­çš„åˆå§‹åŒ– -->
        <!-- åŒ¿åfunctionå¯¹åº”äºOCä¸­æ‰€å‘æ¶ˆæ¯ -->
		bridge.init(function(message, responseCallback) {
			log('JSä¸­ï¼ˆä»OCæ¥æ”¶çš„æ¶ˆæ¯ï¼‰', message)
			var data = { 'ï¼»ï¼»JSä¸­ï¼½ï¼½æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œå¹¶å›å¤':'hello ï¼Œ OC' }
			log('ï¼»ï¼»JSä¸­ï¼½ï¼½å›å¤', data)
			responseCallback(data)
		})
                                   

<!--		bridge.registerHandler('testJavascriptHandler', function(data, responseCallback) {-->
<!--			log('ï¼»ï¼»JSä¸­ï¼½ï¼½ObjC called testJavascriptHandler with', data)-->
<!--			var responseData = { 'Javascript Says':'Right back atcha!' }-->
<!--			log('ï¼»ï¼»JSä¸­ï¼½ï¼½ responding with', responseData)-->
<!--			responseCallback(responseData)-->
<!--		})-->


        <!--æ³¨å†Œ ZXJSHandler æ–¹æ³•-->
        bridge.registerHandler('ZXJSHandler', function(data, responseCallback) {
            log('[JSä¸­]ï¼ŒZXJSHandler be called, withPra: %@', data)
            var backData = {'[JSä¸­]':'ZXJSHandler be called'}
            responseCallback(backData)
            log('[JSä¸­]ï¼ŒZXJSHandler be called, then responding:', backData)
        })
                                   
        <!--åˆ›å»ºä¸€ä¸ªæŒ‰é’®-->
		var button = document.getElementById('buttons').appendChild(document.createElement('button'))
		button.innerHTML = 'å‘é€æ¶ˆæ¯'
              
        <!-- JSå‘OCå‘æ¶ˆæ¯ï¼ŒOCä¸­å·²ç»çš„åˆå§‹åŒ– -->
		button.onclick = function(e) {
			e.preventDefault()
            var data = 'JSä¸­btnç‚¹å‡»ï¼š ZX ,Hello!'
			log('ï¼»ï¼»JSä¸­ï¼½ï¼½ sendingï¼š', data)
        
            // JSå‘æ¶ˆæ¯
			bridge.send(data, function(responseData) {
				log('ï¼»ï¼»JSä¸­ï¼½ï¼½ got response', responseData)
			})
                                   
		}
		document.body.appendChild(document.createElement('br'))
                                   
        var callbackButton = document.getElementById('buttons').appendChild(document.createElement('button'))
        callbackButton.innerHTML = 'ZXOCHandler å‘é€'
        callbackButton.onclick = function(e) {
            e.preventDefault()
            var data = {'ï¼»JSä¸­ï¼½message': 'è¿™æ˜¯ä¸€ä¸ªæ¥è‡ªJSçš„æ¶ˆæ¯ğŸ˜„'}
            log('ï¼»JSä¸­ï¼½ï¼Œå‘é€',data)
            bridge.callHandler('ZXOCHandler', data, function(response) {
                    log('[JSä¸­ï¼½ got response', response)
            })
        }
    })
	</script>

	<div id='buttons'></div> <div id='log'></div>
</body></html>



<!--		var callbackButton = document.getElementById('buttons').appendChild(document.createElement('button'))-->
<!--		callbackButton.innerHTML = 'Fire testObjcCallback'-->
<!--		callbackButton.onclick = function(e) {-->
<!--			e.preventDefault()-->
<!--			log('ï¼»ï¼»JSä¸­ï¼½ï¼½JS calling handler "testObjcCallback"')-->
<!--			bridge.callHandler('testObjcCallback', {'foo': 'bar'}, function(response) {-->
<!--				log('ï¼»ï¼»JSä¸­ï¼½ï¼½JS got response', response)-->
<!--			})-->
<!--		}-->
